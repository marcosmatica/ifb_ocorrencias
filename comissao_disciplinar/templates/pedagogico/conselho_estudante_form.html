{% extends 'core/base.html' %}
{% load static %}

{% block title %}Editar Estudante - {{ estudante.nome }}{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <a class="breadcrumb-item" href="{% url 'pedagogico:conselho_list' %}">Conselhos</a>
    <a class="breadcrumb-item" href="{% url 'pedagogico:conselho_painel' conselho.pk %}">{{ conselho.turma.nome }}</a>
    <a class="breadcrumb-item" href="{% url 'pedagogico:conselho_detail' conselho.pk %}">Detalhes</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-item active">{{ estudante.nome }}</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-header mb-4">
    <div>
        <h1 class="page-title">Informações do Estudante</h1>
        <p class="page-subtitle">{{ estudante.nome }} - {{ conselho.turma.nome }} ({{ conselho.periodo }})</p>
    </div>
    <div>
        <a href="{% url 'pedagogico:conselho_detail' conselho.pk %}" class="btn btn-outline">Voltar</a>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Formulário de Informações -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Informações da Coordenação</h2>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}

                <div class="form-group">
                    <label class="form-label">Observações Gerais</label>
                    {{ form.observacoes_gerais }}
                    {% if form.observacoes_gerais.errors %}
                    <div class="form-error">{{ form.observacoes_gerais.errors }}</div>
                    {% endif %}
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Frequência (%)</label>
                        {{ form.frequencia }}
                        {% if form.frequencia.errors %}
                        <div class="form-error">{{ form.frequencia.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label">Situação Geral</label>
                        {{ form.situacao_geral }}
                        {% if form.situacao_geral.errors %}
                        <div class="form-error">{{ form.situacao_geral.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Participação</label>
                    {{ form.participacao }}
                    {% if form.participacao.errors %}
                    <div class="form-error">{{ form.participacao.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label">Relacionamento</label>
                    {{ form.relacionamento }}
                    {% if form.relacionamento.errors %}
                    <div class="form-error">{{ form.relacionamento.errors }}</div>
                    {% endif %}
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Dificuldades</label>
                        {{ form.dificuldades }}
                        {% if form.dificuldades.errors %}
                        <div class="form-error">{{ form.dificuldades.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label">Potencialidades</label>
                        {{ form.potencialidades }}
                        {% if form.potencialidades.errors %}
                        <div class="form-error">{{ form.potencialidades.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <h3 class="section-title">Encaminhamentos</h3>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-check">
                            {{ form.necessita_acompanhamento }}
                            <span class="form-check-label">Necessita Acompanhamento</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="form-check">
                            {{ form.encaminhamento_cdpd }}
                            <span class="form-check-label">Encaminhamento CDPD</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="form-check">
                            {{ form.encaminhamento_cdae }}
                            <span class="form-check-label">Encaminhamento CDAE</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="form-check">
                            {{ form.encaminhamento_napne }}
                            <span class="form-check-label">Encaminhamento NAPNE</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observações dos Encaminhamentos</label>
                    {{ form.observacoes_encaminhamento }}
                    {% if form.observacoes_encaminhamento.errors %}
                    <div class="form-error">{{ form.observacoes_encaminhamento.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar Informações</button>
                    <a href="{% url 'pedagogico:conselho_detail' conselho.pk %}" class="btn btn-outline">Cancelar</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Observações dos Docentes -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Observações dos Docentes</h2>
        </div>
        <div class="card-body">
            {% if observacoes_docentes %}
                <div class="space-y-4">
                    {% for obs in observacoes_docentes %}
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <strong class="text-sm">{{ obs.disciplina.nome }}</strong>
                            <span class="text-xs text-muted">{{ obs.docente.nome }}</span>
                        </div>

                        <div class="mb-3">
                            <div class="text-xs text-muted mb-1">Observação Geral:</div>
                            <div class="text-sm bg-gray-50 p-2 rounded">{{ obs.observacao }}</div>
                        </div>

                        {% if obs.observacao_napne %}
                        <div>
                            <div class="text-xs text-muted mb-1">Observação NAPNE:</div>
                            <div class="text-sm bg-yellow-50 p-2 rounded">{{ obs.observacao_napne }}</div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Nenhuma observação docente registrada</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}